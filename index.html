<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Groq Airo â€” Bilingual Chat (Auto Detect)</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  :root{--bg1:#0b0018;--accent:#00ffff;--card:rgba(0,0,0,0.45)}
  *{box-sizing:border-box;font-family:"Cairo",sans-serif}
  body{margin:0;height:100vh;display:flex;flex-direction:column;background:
    radial-gradient(circle at top,#2a0073,#000 60%);color:var(--accent)}
  .chat-container{flex:1;overflow:auto;padding:18px 12px 110px;display:flex;flex-direction:column;gap:8px}
  .message{max-width:82%;padding:10px 14px;border-radius:14px;line-height:1.5;font-size:15px;word-break:break-word;box-shadow:0 0 10px rgba(0,255,255,0.08)}
  .message.ai{align-self:flex-start;background:var(--card);border:1px solid rgba(0,255,255,0.12);text-shadow:0 0 4px rgba(0,255,255,0.12)}
  .message.user{align-self:flex-end;background:rgba(0,255,255,0.12);border:1px solid rgba(0,255,255,0.25)}
  .message img{max-width:260px;border-radius:10px;display:block;margin-top:8px;border:1px solid rgba(0,255,255,0.12)}
  .input-area{position:fixed;left:50%;bottom:14px;transform:translateX(-50%);width:96%;max-width:920px;display:flex;gap:10px;align-items:center;flex-direction:row-reverse}
  .input-wrapper{flex:1;background:transparent;border:1.6px solid var(--accent);border-radius:28px;padding:8px 86px 8px 12px;position:relative;backdrop-filter:blur(8px)}
  textarea{width:100%;min-height:36px;max-height:160px;resize:none;border:none;background:transparent;color:var(--accent);outline:none;font-size:15px;line-height:1.4;padding:4px}
  .icon-btn{position:absolute;top:50%;transform:translateY(-50%);width:36px;height:36px;border-radius:50%;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.45);border:1px solid rgba(0,255,255,0.12);cursor:pointer}
  #micBtn{right:46px} #imgBtn{right:8px}
  #sendBtn{width:48px;height:48px;border-radius:50%;background:#000;border:1px solid var(--accent);display:flex;align-items:center;justify-content:center;cursor:pointer}
  .typing{font-style:italic;color:rgba(0,255,255,0.7);padding:8px;border-radius:12px;align-self:flex-start}
  @media(max-width:480px){.message img{max-width:160px}.input-wrapper{padding:8px 70px 8px 10px}}
</style>
</head>
<body>
  <div class="chat-container" id="chatContainer">
    <div class="message ai">Ø£Ù‡Ù„Ø§Ù‹! Ø£Ù†Ø§ <strong>Airo</strong>. Ø£Ù‚Ø¯Ø± Ø£ØªÙƒÙ„Ù… Ø¹Ø±Ø¨ÙŠ Ø£Ùˆ Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ Ø­Ø³Ø¨ Ù„ØºØªÙƒ ðŸ˜Š.</div>
  </div>

  <div class="input-area">
    <div class="input-wrapper">
      <textarea id="userInput" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø© Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠ Ø£Ùˆ Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ..."></textarea>
      <button class="icon-btn" id="imgBtn" title="Ø±ÙØ¹ ØµÙˆØ±Ø© (PNG/JPG)">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M21 19V5H3v14h18zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z" fill="currentColor"/></svg>
      </button>
      <button class="icon-btn" id="micBtn" title="ØªØ­Ø¯Ø«">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M12 14a3 3 0 0 0 3-3V5a3 3 0 0 0-6 0v6a3 3 0 0 0 3 3zM17 11a5 5 0 0 1-10 0" fill="currentColor"/></svg>
      </button>
    </div>
    <button id="sendBtn" title="Ø¥Ø±Ø³Ø§Ù„">
      <svg width="22" height="22" viewBox="0 0 24 24" fill="none"><path d="M2 21l21-9L2 3v7l15 2-15 2v7z" fill="currentColor"/></svg>
    </button>
  </div>
  <input type="file" id="imageInput" accept="image/*" style="display:none" />

<script>
const GROQ_API_KEY = "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";
const GROQ_ENDPOINT = "https://api.groq.com/openai/v1/chat/completions";
const MODEL_NAME = "llama-3.1-8b-instant"; // Ø£Ù‚ÙˆÙ‰ ÙˆØ£Ø¯Ù‚ ÙÙŠ Ø§Ù„Ù„ØºØªÙŠÙ†

const chatContainer = document.getElementById('chatContainer');
const userInput = document.getElementById('userInput');
const sendBtn = document.getElementById('sendBtn');
const micBtn = document.getElementById('micBtn');
const imgBtn = document.getElementById('imgBtn');
const imageInput = document.getElementById('imageInput');

let pendingImageDataUrl = null;
let conversation = [
  { role: "system", content: "You are Airo, a bilingual AI assistant created by Mohamed Eltras. You automatically respond in the same language as the user (Arabic or English). You are friendly, motivational, and precise in answers." }
];

function addMessage(text, who='ai', imgSrc=null){
  const div = document.createElement('div');
  div.className = 'message ' + (who==='user' ? 'user' : 'ai');
  div.textContent = text;
  if(imgSrc){
    const img = document.createElement('img');
    img.src = imgSrc;
    div.appendChild(img);
  }
  chatContainer.appendChild(div);
  chatContainer.scrollTop = chatContainer.scrollHeight;
}

function showTyping(){
  const d = document.createElement('div');
  d.className = 'typing';
  d.id = 'typingIndicator';
  d.textContent = 'Ø¬Ø§Ø±Ù Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...';
  chatContainer.appendChild(d);
  chatContainer.scrollTop = chatContainer.scrollHeight;
}
function removeTyping(){
  const t = document.getElementById('typingIndicator');
  if(t) t.remove();
}

imgBtn.addEventListener('click', ()=> imageInput.click());
imageInput.addEventListener('change', (e)=>{
  const file = e.target.files[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload = ()=> {
    pendingImageDataUrl = reader.result;
    addMessage("ðŸ“· ØªÙ… Ø±ÙØ¹ ØµÙˆØ±Ø© Ù„Ù„ØªØ­Ù„ÙŠÙ„.", 'user', pendingImageDataUrl);
  };
  reader.readAsDataURL(file);
});

sendBtn.addEventListener('click', sendMessage);
userInput.addEventListener('keydown', (e)=>{
  if(e.key === 'Enter' && !e.shiftKey){ e.preventDefault(); sendMessage(); }
});

async function sendMessage(){
  const text = userInput.value.trim();
  if(!text && !pendingImageDataUrl) return;

  addMessage(text || "ðŸ“· Ø£Ø±Ø³Ù„Øª ØµÙˆØ±Ø©", 'user', pendingImageDataUrl);
  userInput.value = ''; showTyping();

  let userContent = text || "";
  if(pendingImageDataUrl){
    userContent += "\n\n[IMAGE_BASE64_START]\n" + pendingImageDataUrl + "\n[IMAGE_BASE64_END]";
  }

  conversation.push({ role: "user", content: userContent });

  const payload = {
    model: MODEL_NAME,
    messages: conversation,
    max_tokens: 1400
  };

  try {
    const res = await fetch(GROQ_ENDPOINT, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": "Bearer " + GROQ_API_KEY
      },
      body: JSON.stringify(payload)
    });

    const data = await res.json();
    removeTyping();

    const aiText = data.choices?.[0]?.message?.content || "Ù„Ù… Ø£ÙÙ‡Ù… Ø§Ù„Ø±Ø¯.";
    addMessage(aiText, 'ai');
    conversation.push({ role: "assistant", content: aiText });

  } catch(err){
    removeTyping();
    addMessage("âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„: " + err.message, 'ai');
  } finally {
    pendingImageDataUrl = null;
  }
}

micBtn.addEventListener('click', ()=>{
  if(!('webkitSpeechRecognition' in window)){
    alert('Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ† ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ… Ù‡Ù†Ø§.');
    return;
  }
  const recognition = new webkitSpeechRecognition();
  recognition.lang = 'ar-EG';
  recognition.interimResults = false;
  recognition.onstart = ()=> micBtn.style.opacity='0.5';
  recognition.onend = ()=> micBtn.style.opacity='';
  recognition.onresult = e=>{
    userInput.value = e.results[0][0].transcript;
  };
  recognition.start();
});
</script>
</body>
</html>
